import{b as E,r as d,j as e,H as z,a as g}from"./app-DG6B9Tz2.js";import{S as n}from"./sweetalert2.esm.all-Y6IUEg8t.js";import{r as D,l as U}from"./auth-BnBS03Jv.js";import{a as b}from"./authHistoryManager-C0uFoHhB.js";import{A as V,U as y}from"./user-CsSJiasZ.js";import{C as N}from"./chevron-down-MEWfku0p.js";import{S as C}from"./settings-QtM3wUch.js";import{L as M}from"./log-out-D8Ne50oJ.js";function $(){const{props:i}=E(),s=!!i.auth?.user;return d.useEffect(()=>{s?(b.setAuthenticated(!0),window.location.pathname!=="/login"&&performance.getEntriesByType("navigation")[0].type!=="reload"&&b.preventBackNavigation()):b.setUnauthenticated()},[s]),d.useEffect(()=>{const l=u=>{try{if(s&&window.location.pathname==="/login"){u.preventDefault(),window.history.forward();const c=i.auth?.user;let r="/dashboard";if(c?.role)switch(c.role){case"Asistenciales":r="/dashboard/asistenciales";break;case"Administrativos":r="/dashboard/administrativos";break;case"Direccionamiento":r="/dashboard/direccionamiento";break;case"Financieros":r="/dashboard/financieros";break;case"Administrador":r="/dashboard/administrador";break}setTimeout(()=>{try{window.location.href=r}catch(x){console.error("Error redirecting to dashboard:",x),window.location.href="/dashboard"}},50)}}catch(c){console.error("Error in popstate handler:",c)}};if(s)return window.addEventListener("popstate",l),()=>{try{window.removeEventListener("popstate",l)}catch(u){console.warn("Error removing popstate listener:",u)}}},[s,i.auth?.user]),{isAuthenticated:s,user:i.auth?.user}}function J({children:i,title:s,pageTitle:l,pageDescription:u,icon:c,showBackButton:r=!1,backUrl:x="/dashboard"}){const[p,v]=d.useState(!1),[f,B]=d.useState(!1),[L,j]=d.useState(!1),{props:S}=E(),m=S.auth?.user;$();const P=async()=>{if(!L)try{j(!0),v(!1),await D()}catch(a){U("AppLayout.handleLogout",a),console.error("游뚿 Unexpected logout error:",a),window.location.href="/login"}finally{j(!1)}},A=async()=>{const{value:a}=await n.fire({title:"Cambiar Email",input:"email",inputLabel:"Nuevo correo electr칩nico",inputValue:m?.email||"",inputPlaceholder:"usuario@huv.com",showCancelButton:!0,confirmButtonText:"Actualizar",cancelButtonText:"Cancelar",confirmButtonColor:"#2a3d85",inputValidator:o=>{if(!o)return"Debes ingresar un email v치lido";if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o))return"El formato del email no es v치lido"}});a&&g.patch("/profile/email",{email:a},{onSuccess:()=>{n.fire({title:"춰Email actualizado!",text:`Tu nuevo email es: ${a}`,icon:"success",confirmButtonColor:"#2a3d85"})},onError:o=>{const w=Object.values(o).flat().join(`
`);n.fire({title:"Error",text:w||"No se pudo actualizar el email",icon:"error",confirmButtonColor:"#2a3d85"})}})},k=async()=>{const{value:a}=await n.fire({title:"Cambiar Contrase침a",text:"Paso 1 de 3: Ingresa tu contrase침a actual",input:"password",inputLabel:"Contrase침a actual",inputPlaceholder:"Ingresa tu contrase침a actual",showCancelButton:!0,confirmButtonText:"Siguiente",cancelButtonText:"Cancelar",confirmButtonColor:"#2a3d85",inputValidator:t=>{if(!t)return"Debes ingresar tu contrase침a actual"}});if(!a)return;const{value:o}=await n.fire({title:"Cambiar Contrase침a",text:"Paso 2 de 3: Ingresa tu nueva contrase침a",input:"password",inputLabel:"Nueva contrase침a",inputPlaceholder:"M칤nimo 6 caracteres",showCancelButton:!0,confirmButtonText:"Siguiente",cancelButtonText:"Cancelar",confirmButtonColor:"#2a3d85",inputValidator:t=>{if(!t)return"Debes ingresar una nueva contrase침a";if(t.length<6)return"La nueva contrase침a debe tener al menos 6 caracteres"}});if(!o)return;const{value:w}=await n.fire({title:"Cambiar Contrase침a",text:"Paso 3 de 3: Confirma tu nueva contrase침a",input:"password",inputLabel:"Confirmar nueva contrase침a",inputPlaceholder:"Repite tu nueva contrase침a",showCancelButton:!0,confirmButtonText:"Actualizar",cancelButtonText:"Cancelar",confirmButtonColor:"#2a3d85",inputValidator:t=>{if(!t)return"Debes confirmar tu nueva contrase침a";if(t!==o)return"Las contrase침as no coinciden"}});if(!w)return;const h={currentPassword:a,newPassword:o};h&&g.patch("/profile/password",{current_password:h.currentPassword,password:h.newPassword,password_confirmation:h.newPassword},{onSuccess:()=>{n.fire({title:"춰Contrase침a actualizada!",text:"Tu contrase침a ha sido cambiada exitosamente",icon:"success",confirmButtonColor:"#2a3d85"})},onError:t=>{const T=Object.values(t).flat().join(`
`);n.fire({title:"Error",text:T||"No se pudo actualizar la contrase침a",icon:"error",confirmButtonColor:"#2a3d85"})}})};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(z,{title:s}),e.jsx("div",{className:"bg-[#2a3d85] text-white p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[r&&e.jsx("button",{onClick:()=>g.get(x),className:"mr-4 p-2 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(V,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsx(c,{className:"w-8 h-8 mr-3"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:l}),e.jsx("p",{className:"opacity-90",children:u})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium",children:"Hospital Universitario del Valle"}),e.jsx("p",{className:"text-xs opacity-90",children:'"Evaristo Garcia" E.S.E'})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>v(!p),className:"flex items-center space-x-2 bg-white/10 hover:bg-white/20 rounded-lg px-3 py-2 transition-colors",children:[e.jsx(y,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:m?.name||""}),e.jsx(N,{className:`w-4 h-4 transition-transform duration-200 ${p?"rotate-180":""}`})]}),e.jsx("div",{className:`absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 z-50 transition-all duration-200 origin-top-right ${p?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-95 -translate-y-2 pointer-events-none"}`,children:e.jsxs("div",{className:"py-2",children:[e.jsxs("div",{className:"px-4 py-2 border-b border-gray-100",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:m?.name||""}),e.jsx("p",{className:"text-xs text-gray-500",children:m?.email||"email@huv.com"})]}),e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:()=>B(!f),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center justify-between transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsx("span",{children:"Ajustes"})]}),e.jsx(N,{className:`w-3 h-3 transition-transform duration-200 ${f?"rotate-180":""}`})]}),e.jsxs("div",{className:`transition-all duration-200 overflow-hidden ${f?"max-h-20 opacity-100":"max-h-0 opacity-0"}`,children:[e.jsxs("button",{onClick:A,className:"w-full text-left px-8 py-2 text-sm text-gray-600 hover:bg-gray-50 flex items-center space-x-2 transition-colors",children:[e.jsx(y,{className:"w-3 h-3"}),e.jsx("span",{children:"Cambiar Email"})]}),e.jsxs("button",{onClick:k,className:"w-full text-left px-8 py-2 text-sm text-gray-600 hover:bg-gray-50 flex items-center space-x-2 transition-colors",children:[e.jsx(C,{className:"w-3 h-3"}),e.jsx("span",{children:"Cambiar Contrase침a"})]})]})]}),e.jsxs("button",{onClick:P,className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center space-x-2 transition-colors mt-2",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{children:"Cerrar Sesi칩n"})]})]})})]})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:i})]})}export{J as A};
